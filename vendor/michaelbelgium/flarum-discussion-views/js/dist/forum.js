(()=>{var t={n:e=>{var s=e&&e.__esModule?()=>e.default:()=>e;return t.d(s,{a:s}),s},d:(e,s)=>{for(var o in s)t.o(s,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:s[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e);const s=flarum.core.compat.app;var o=t.n(s);const n=flarum.core.compat.extend,r=flarum.core.compat["states/DiscussionListState"];var i=t.n(r);const a=flarum.core.compat.Model;var u=t.n(a);const c=flarum.core.compat["models/Discussion"];var l=t.n(c);const p=flarum.core.compat["components/DiscussionListItem"];var d=t.n(p);const f=flarum.core.compat["components/DiscussionList"];var v=t.n(f);const h=flarum.core.compat["utils/abbreviateNumber"];var w=t.n(h);function b(t,e){return b=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},b(t,e)}function y(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,b(t,e)}var g=function(t){function e(){for(var e,s=arguments.length,o=new Array(s),n=0;n<s;n++)o[n]=arguments[n];return(e=t.call.apply(t,[this].concat(o))||this).visitedAt=u().attribute("visited_at",u().transformDate),e.user=u().hasOne("user"),e.discussion=u().hasOne("discussion"),e}return y(e,t),e}(u());const _=flarum.core.compat["components/Button"];var N=t.n(_);const V=flarum.core.compat["utils/DiscussionControls"];var M=t.n(V);const D=flarum.core.compat["components/Modal"];var O=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var s=e.prototype;return s.oninit=function(e){t.prototype.oninit.call(this,e),this.discussion=this.attrs.discussion,this.currentViewsCount=this.discussion.viewCount()},s.content=function(){return m("div",{className:"Modal-body"},m("div",{className:"Form Form--centered"},m("p",null,app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.label",{count:this.currentViewsCount})),m("div",{className:"Form-group"},N().component({className:"Button Button--primary Button--block",type:"submit",loading:this.loading},app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.submit_button")))))},s.title=function(){return app.translator.trans("michaelbelgium-discussion-views.forum.modal_resetviews.title")},s.className=function(){return"Modal--small"},s.onsubmit=function(t){var e=this;t.preventDefault(),this.loading=!0,this.attrs.discussion.save({resetViews:!0}).catch((function(){e.loaded()})),this.hide()},e}(t.n(D)());const P=flarum.core.compat["helpers/username"];var C=t.n(P);const L=flarum.core.compat["helpers/icon"];var x=t.n(L);const S=flarum.core.compat["helpers/punctuateSeries"];var j=t.n(S);const k=flarum.core.compat["helpers/avatar"];var F=t.n(k);const q=flarum.core.compat["utils/ItemList"];var A=t.n(q);const B=flarum.core.compat["utils/humanTime"];var I=t.n(B);const U=flarum.core.compat["components/CommentPost"];var R=t.n(U);const T=flarum.core.compat["components/Link"];var z=t.n(T);const E=flarum.core.compat["components/DiscussionPage"];var G=t.n(E);const H=flarum.core.compat["components/FieldSet"];var J=t.n(H);const K=flarum.core.compat["common/components/Modal"];var Q=function(t){function e(){return t.apply(this,arguments)||this}y(e,t);var s=e.prototype;return s.className=function(){return"Modal--small"},s.title=function(){return app.translator.trans("michaelbelgium-discussion-views.forum.post.modal_title_text")},s.content=function(){var t=this.attrs.post.discussion().uniqueViews().map((function(t){var e=t.user();return m("li",null,m(z(),{href:app.route.user(e)},F()(e)," "," ",C()(e)))}));return m("div",{className:"Modal-body"},m("ul",{className:"PostLikesModal-list"},t))},e}(t.n(K)());o().initializers.add("michaelbelgium-discussion-views",(function(){(0,n.extend)(i().prototype,"sortMap",(function(t){1==app.forum.attribute("toggleFilter")&&(t.popular="-view_count",t.unpopular="view_count")})),o().store.models.discussionviews=g,l().prototype.views=u().hasMany("latestViews"),l().prototype.uniqueViews=u().hasMany("uniqueViews"),l().prototype.canReset=u().attribute("canReset"),l().prototype.canViewNumber=u().attribute("canViewNumber"),l().prototype.viewCount=u().attribute("viewCount"),(0,n.extend)(d().prototype,"infoItems",(function(t){if(this.attrs.discussion.canViewNumber()){var e=this.attrs.discussion.viewCount(),s=1==o().forum.attribute("abbrNumber")?w()(e):e;t.add("discussion-views",m("span",null,s))}})),(0,n.extend)(v().prototype,"requestParams",(function(t){t.include.push("latestViews")})),(0,n.extend)(M(),"moderationControls",(function(t,e){e.canReset()&&e.viewCount()>0&&t.add("reset",m(N(),{icon:"far fa-eye-slash",onclick:function(){return app.modal.show(O,{discussion:e})}},app.translator.trans("michaelbelgium-discussion-views.forum.discussion_controls.resetviews_button")))})),(0,n.extend)(G().prototype,"sidebarItems",(function(t){if(0!=app.forum.attribute("showViewList")){var e=this.discussion.views(),s=new(A());$.each(e,(function(t,e){var o=!1===e.user()?app.translator.trans("michaelbelgium-discussion-views.forum.viewlist.guest"):e.user().username(),n=m("div",{className:"item-lastUser-content"},F()(e.user()),m("div",null,o,m("span",{className:"lastUser-visited",title:e.visitedAt().toLocaleString()},I()(e.visitedAt()))));!1!==e.user()&&(n=m(z(),{href:app.route.user(e.user())},n)),s.add("lastUser-"+t,n)})),t.add("lastDiscussionViewers",m(J(),{className:"LastDiscussionUsers",label:app.translator.trans("michaelbelgium-discussion-views.forum.viewlist.title")},s.toArray()))}})),(0,n.extend)(R().prototype,"footerItems",(function(t){if(0!=app.forum.attribute("showFooterViewList")){var e=this.attrs.post,s=e.discussion(),o=s.uniqueViews(),n=s.posts()[0];if(console.log(n),void 0!==n&&n.id()===e.id()&&o&&o.length>0){var r=o.slice(0,5).map((function(t){return m(z(),{href:app.route.user(t.user())},t.user()===app.session.user?app.translator.trans("michaelbelgium-discussion-views.forum.post.you"):C()(t.user()))}));if(o.length>5){var i=o.length-5;r.push(m(z(),{href:"#",onclick:function(t){t.preventDefault(),app.modal.show(Q,{post:e})}},app.translator.trans("michaelbelgium-discussion-views.forum.post.others_link",{count:i})))}r.length>0&&t.add("viewed",m("div",{className:"Post-Discussion-viewedBy"},x()("fas fa-eye"),app.translator.trans("michaelbelgium-discussion-views.forum.post.viewed_by",{users:j()(r)})))}}}))}))})(),module.exports=e})();
//# sourceMappingURL=forum.js.map